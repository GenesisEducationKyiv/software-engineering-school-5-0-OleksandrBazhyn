# Мікросервісна декомпозиція Weather API App

## Поточна архітектура проекту

Проект представляє собою монолітну Node.js/Express.js аплікацію з наступними компонентами:
- RESTful API для отримання погоди
- Система підписок на email-розсилку
- WebSocket сервер для real-time оновлень
- Система метрик та моніторингу
- Scheduler для автоматичних розсилок
- Redis кешування
- PostgreSQL база даних

## Рекомендовані мікросервіси

### 1. Weather Service
**Відповідальність:** Отримання та кешування погодних даних

**Включає:**
- [`WeatherProviderManagerInterface`](server/src/services/weather/WeatherProviderManagerInterface.ts) та його реалізації
- Інтеграція з стороннім API
- Redis кешування погодних даних
- Логіка обробки погодних запитів

**Обґрунтування:** Незалежна бізнес-логіка з власними зовнішніми залежностями (погодні API)

### 2. Subscription Service
**Відповідальність:** Управління підписками користувачів

**Включає:**
- [`SubscriptionService`](server/src/services/subscription/SubscriptionService.ts)
- [`SubscriptionDataProvider`](server/src/services/subscription/SubscriptionDataProvider.ts)
- Операції CRUD для підписок
- Логіка підтвердження та відписки

**Обґрунтування:** Окрема бізнес-сутність з власною базою даних, що працює на підписки

### 3. Email Service
**Відповідальність:** Відправка email-повідомлень

**Включає:**
- [`MailManager`](server/src/services/email/MailManager.ts)
- Шаблони листів
- Інтеграція з Gmail SMTP
- Логіка формування контенту

**Обґрунтування:** Незалежна зовнішня інтеграція, яка може масштабуватися окремо

### 4. Metrics Service
**Відповідальність:** Збір та надання метрик

**Включає:**
- [`MetricsController`](server/src/controllers/MetricsController.ts)
- Метрики кешування
- Dashboard для моніторингу
- Агрегація статистики

**Обґрунтування:** Кросс-функціональний сервіс для всіх компонентів

## Оптимальна мікросервісна комунікація

### gRPC
- **Subscription Service <-> Weather Service**: Отримання погоди для підписок швидко

### Синхронна комунікація (HTTP/REST)
- **Metrics Service <-> Усі сервіси**: Збір метрик
- **Клієнт <-> Subscription Service**: Для керування станом підписки
- **Клієнт <-> Weather Service**: Одноразово отримати дані по погоді

### Асинхронна комунікація через Message Broker
- **Subscription Service <-> Email Service**: Для задачі масової розсилки email Subscription Service публікує події у брокер (наприклад, send_weather_email), а Email Service підписаний на ці події та виконує відправку листів. Це дозволяє досягти асинхронності, масштабованості та підвищити fault tolerance системи.


### Рекомендований Message Broker
**Redis Pub/Sub** або **RabbitMQ** — рекомендується для асинхронної комунікації, наприклад, для передачі подій між Subscription Service та Email Service (наприклад, коли потрібно надіслати email після підписки). Оскільки Redis вже використовується в проекті, його Pub/Sub можна застосувати для простих сценаріїв, але для складніших черг і гарантій доставки краще розглянути RabbitMQ.

## Переваги декомпозиції

1. **Незалежне масштабування**: Email Service може масштабуватися окремо від Weather Service
2. **Fault tolerance**: Падіння одного сервісу не впливає на інші
3. **Технологічна незалежність**: Кожен сервіс може використовувати оптимальні технології
4. **Команди розробки**: Можливість розподілити розробку між командами

## Потенційні виклики

1. **Складність**: Збільшення операційної складності
2. **Мережна комунікація**: Додаткові мережні виклики
3. **Консистентність даних**: Необхідність eventual consistency
4. **Моніторинг**: Потреба в distributed tracing
5. **Забагато різнотипної комунікації з Weather Service**: Треба підтримувати різні типи комунікації
6. **Завеликий Subscription Service**: Буде складніше працювати в команді над ним

## Рекомендації щодо впровадження

1. **Поступова міграція**: Починати з виділення Email Service
2. **API Gateway**: Для уніфікованого доступу до сервісів
3. **Service Discovery**: Для динамічного пошуку сервісів
4. **Circuit Breaker**: Для обробки збоїв між сервісами
5. **Centralized Logging**: Для агрегації логів з усіх сервісів